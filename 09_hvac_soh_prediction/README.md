# 공조기기 전력 사용 상태 분석 (HVAC SOH Prediction)

## 1. 사전 세팅

* fonts-nanum 설치 및 matplotlib 캐시 초기화

---

## 2. 문제 정의

* 공장 설비는 온도·습도·전력 상태 등 다양한 센서를 통해 건강 상태(SOH)를 표현함
* 예지보전을 위해 **설비의 상태(정상·주의·경고)를 조기에 분류하는 모델**이 필요
* 삼상(Three-phase) 모터 기반 전력 구조 특성상 **센서 간 다중공선성**이 매우 강함
* 센서 데이터를 일 단위로 집계해 SOH 분류 모델 구축

---

## 2.1 도메인 지식

### ▸ 공조기기(HVAC)

* 공정 환경의 온도·습도·환기 상태를 일정하게 유지하는 핵심 설비
* 반도체·식품·의약품 등 생산 품질에 민감한 산업에서 필수 장비

### ▸ 예지보전(Predictive Maintenance)

* 센서 데이터를 기반으로 고장 가능성을 사전에 감지
* 정기 점검 대비 **효율적·경제적 유지보수** 가능

### ▸ 삼상 전력(Three-phase Power)

* 산업용 전력 공급 방식(120° 위상차 3선식)
* 모터 관성 때문에 R/S/T 상 센서 값이 항상 비슷하게 움직여 **다중공선성 발생**

---

## 3. 데이터 간단 확인

### ▸ 데이터 명세

| Column       | Description                                   |
| ------------ | --------------------------------------------- |
| DEVICE_ID    | 설비 번호                                         |
| DEVICE_BD_ID | 건물 번호                                         |
| data         | 센서 로그(JSON: ITEM_NAME, ITEM_VALUE, TIMESTAMP) |

* 총 **1,509,795행 × 3컬럼**
* 센서 종류: **36개(R/S/T 상 전류·전압·역률·유효전력 등)**
* 1분 단위 로그 → 일 단위로 집계하여 **43,137행 × 36컬럼**으로 변환
* 라벨(정상/주의/경고)과 매핑해 학습 테이블 구성(43,137행 × 37컬럼)

---

## 4. 문제 해결 프로세스 정의

### ▸ 문제

* 설비 정비가 계획/사후 방식에 의존 → 장애 시 생산 중단 비용 발생
* 설비별 SOH를 자동 분류해 조기 경고 필요

### ▸ 기대 효과

* 다운타임 감소 및 생산 안정성 확보
* 고장 이전에 조치 가능 → 비용 절감

### ▸ 해결 방안

* JSON 파싱 → 센서 기준 테이블 변환
* 다중공선성(VIF) 분석 후 Feature Selection
* RandomForest 기반 분류 모델 구축

### ▸ 성과 측정

* 설비 SOH 예측 정확도(Test Accuracy)
* 정상/주의/경고 분류 성능

### ▸ 현업 적용

* 4000개 이상 센서가 발생하는 실제 환경에서는 **Feature Selection이 필수**
* 관리자가 활용할 수 있는 신호등형(SOH) 모니터링 시스템으로 확장 가능

---

## 5. Data Readiness Check

* 전체 36개 센서 중 삼상 관련 센서에서 **VIF 100,000+** 수준의 극단적 다중공선성 확인
* 상관행렬(Heatmap)에서도 R/S/T 상 전력·전류·고조파 계열이 거의 0.95 수준으로 묶여 있음
* 단순 통계 기반 Feature Removal이 어려워 모델 기반 중요도 활용 필요

---

## 6. Feature Engineering

* JSON → item_name, item_value, timestamp 분리
* Pivot으로 센서별 시계열 구성
* timestamp 정렬 후 label 병합
* Histogram, 상관행렬 시각화

---

## 7. 모델링

### ▸ RandomForest (n_estimators=50, max_features=20)

* Train Accuracy: **0.9999**
* Test Accuracy: **0.9517**

### ▸ Feature Importance 기반 축소 실험

| 사용 컬럼 수 | Test Accuracy      |
| ------- | ------------------ |
| 전체 36개  | 0.9517             |
| 상위 20개  | **0.9520 (소폭 상승)** |
| 상위 10개  | 0.9515 (거의 동일)     |

→ **상위 10~20개만 사용해도 모델 성능 유지 → 메모리·서빙 부담 대폭 감소**

### ▸ 중요 Feature 예시

`역률평균`, `R상유효전력`, `T상전류`, `S상유효전력`, `전류평균`, `유효전력평균` 등

---

## 8. 결론

* 삼상 전력 구조로 인해 센서 전반에 매우 강한 다중공선성이 존재
* 공선성이 높은 신호를 모두 사용하면 모델 안정성이 떨어져 **Feature Selection이 필수적**
* 상위 10~20개 센서만으로도 약 **95%의 분류 성능**을 확보해, 실제 배포 환경에서 효율적
* 주의 상태 오탐/미탐이 일부 존재해 향후 추세 기반 Feature 도입 필요
* SOH 신호등 알람 시스템 구축 시 Feature Importance + Domain Knowledge 결합 필요